<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="drvfast_install_files/filelist.xml">
<link rel=Edit-Time-Data href="drvfast_install_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>PREfast is a powerful tool for finding certain classes of errors not
easily found by the typical compiler, and to provide advi</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="PersonName" downloadurl="http://www.microsoft.com"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Maureen Carmichael</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>Terri L. Norris</o:LastAuthor>
  <o:Revision>3</o:Revision>
  <o:TotalTime>22877</o:TotalTime>
  <o:Created>2003-08-08T22:51:00Z</o:Created>
  <o:LastSaved>2004-07-22T16:37:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>7063</o:Words>
  <o:Characters>40264</o:Characters>
  <o:Company>Microsoft Corporation</o:Company>
  <o:Lines>335</o:Lines>
  <o:Paragraphs>94</o:Paragraphs>
  <o:CharactersWithSpaces>47233</o:CharactersWithSpaces>
  <o:Version>11.5703</o:Version>
 </o:DocumentProperties>
 <o:CustomDocumentProperties>
  <o:_ReviewCycleID dt:dt="float">936012167</o:_ReviewCycleID>
  <o:_EmailEntryID dt:dt="string">000000003530BC13B6151245BA3F92B4344D3EC807008CC03F47967BF14D9710887723FADDB6000000ABB2C80000E6564B8F86852D46A4E98C485FB33B8F000000F116010000</o:_EmailEntryID>
  <o:_AdHocReviewCycleID dt:dt="float">1304978561</o:_AdHocReviewCycleID>
  <o:_PreviousAdHocReviewCycleID dt:dt="float">1885891058</o:_PreviousAdHocReviewCycleID>
  <o:_EmailStoreID dt:dt="string">0000000038A1BB1005E5101AA1BB08002B2A56C20000454D534D44422E444C4C00000000000000001B55FA20AA6611CD9BC800AA002FC45A0C0000005245442D4D53472D3233002F4F3D6D6963726F736F66742F4F553D6E6F727468616D65726963612F636E3D526563697069656E74732F636E3D612D6D616861727200</o:_EmailStoreID>
  <o:_EmailSubject dt:dt="string">PREfast doc</o:_EmailSubject>
  <o:_AuthorEmail dt:dt="string">maurc@windows.microsoft.com</o:_AuthorEmail>
  <o:_AuthorEmailDisplayName dt:dt="string">Maureen Carmichael</o:_AuthorEmailDisplayName>
  <o:_ReviewingToolsShownOnce dt:dt="string"></o:_ReviewingToolsShownOnce>
 </o:CustomDocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:1627421319 -2147483648 8 0 66047 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:none;
	mso-outline-level:1;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:22.0pt;
	font-family:Arial;
	mso-font-kerning:0pt;
	font-weight:normal;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-weight:bold;
	font-style:italic;}
p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.MsoFootnoteReference
	{mso-style-noshow:yes;
	vertical-align:super;}
span.MsoCommentReference
	{mso-style-noshow:yes;
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;}
span.MsoEndnoteReference
	{mso-style-noshow:yes;
	vertical-align:super;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	background:navy;
	font-size:12.0pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-noshow:yes;
	mso-style-parent:"Comment Text";
	mso-style-next:"Comment Text";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;}
span.path1
	{mso-style-name:path1;
	color:black;
	font-weight:bold;}
span.warning1
	{mso-style-name:warning1;
	color:red;
	font-weight:bold;}
span.warningattop
	{mso-style-name:warningattop;
	font-family:Arial;
	mso-ascii-font-family:Arial;
	mso-hansi-font-family:Arial;
	mso-bidi-font-family:Arial;
	color:black;
	font-weight:bold;}
 /* Page Definitions */
 @page
	{mso-footnote-separator:url("drvfast_install_files/header.htm") fs;
	mso-footnote-continuation-separator:url("drvfast_install_files/header.htm") fcs;
	mso-endnote-separator:url("drvfast_install_files/header.htm") es;
	mso-endnote-continuation-separator:url("drvfast_install_files/header.htm") ecs;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 65.95pt 1.0in 65.95pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:74055834;
	mso-list-type:hybrid;
	mso-list-template-ids:-2096464982 1099993552 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-start-at:0;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:30.0pt;
	mso-level-number-position:left;
	margin-left:30.0pt;
	text-indent:-.25in;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
@list l0:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1
	{mso-list-id:1075012719;
	mso-list-type:hybrid;
	mso-list-template-ids:-1553675634 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	margin-left:1.0in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l1:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2
	{mso-list-id:1854760075;
	mso-list-type:hybrid;
	mso-list-template-ids:-442838138 1099993552 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l2:level1
	{mso-level-start-at:0;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:66.0pt;
	mso-level-number-position:left;
	margin-left:66.0pt;
	text-indent:-.25in;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
@list l2:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
<!--[if gte mso 9]>
<xml><o:shapedefaults v:ext="edit" spidmax="1027"/>
</xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoPlainText align=center style='margin-right:21.1pt;text-align:center'><b
style='mso-bidi-font-weight:normal'><span style='font-size:14.0pt;font-family:
Arial'>PREfast: Getting Started<o:p></o:p></span></b></p>

<p class=MsoPlainText align=center style='margin-right:21.1pt;text-align:center'><b
style='mso-bidi-font-weight:normal'><span style='font-size:11.0pt;font-family:
Arial'>With new driver-specific rules<o:p></o:p></span></b></p>

<h2>Introduction</h2>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>PREfast (<i style='mso-bidi-font-style:normal'>prefast.exe</i>) is a
tool that detects certain classes of errors not easily found by the typical
compiler. This tool also provides the advice and opinions of the PREfast
developers about the reliability of certain coding constructs. It operates on
each function in the source separately, producing a single combined list for
all the files checked in a single run, with duplicates (from headers)
eliminated.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><i style='mso-bidi-font-style:
normal'><span style='font-family:Arial'>These notes now include the first
update of PREfast with driver-specific rules</span></i><span style='font-family:
Arial'>.<span style='mso-spacerun:yes'>  </span>For those who are already familiar
with PREfast, the new information is collected in the section “<b
style='mso-bidi-font-weight:normal'>Additions for the driver-specific version
of PREfast</b>” at the end of this document.<span style='mso-spacerun:yes'> 
</span>Note that the driver-specific rules make this DDK version inappropriate
to use on code other than drivers.<span style='mso-spacerun:yes'>  </span>The
setup to run with the driver specific rules is described in that new section.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>This is an informal introduction to what PREfast does, what to expect
from it, and how to use it. For more information, see the PREfast Help file,
which is included in the Microsoft®&nbsp;Windows® Driver Development Kit (DDK)
documentation. <o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>To illustrate what PREfast does, here is an example of an error that
PREfast detected in code from a real device driver (abstracted to remove
identifying information):<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-size:8.0pt;
color:gray'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(&nbsp;pSrb-&gt;Property-&gt;Id&nbsp;){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;CUR_MODE:<o:p></o:p></span></p>

<div style='margin-right:21.1pt'>

<div style='mso-element:para-border-div;border:none;border-top:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;padding:0in 0in 0in 0in'>

<p class=MsoPlainText style='border:none;mso-border-top-alt:solid windowtext .5pt;
padding:0in;mso-padding-alt:0in 0in 0in 0in'><span style='font-size:7.5pt;
color:gray'><o:p>&nbsp;</o:p></span></p>

</div>

</div>

<p class=MsoPlainText style='margin-right:21.1pt'><b><span style='font-family:
Arial;color:black'><span style='mso-spacerun:yes'>            </span>PREfast
analysis path begins<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial;color:gray'><span style='mso-spacerun:yes'>            </span></span><span
style='font-size:8.0pt;color:gray'>1003</span><span class=warning1><span
style='font-size:8.0pt'><span style='mso-spacerun:yes'>        
</span>if(&nbsp;(*(PULONG)(pSrb-&gt;PropertyInfo))&nbsp;&amp;</span></span><span
style='font-family:Arial;color:black'> <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:30.0pt;text-indent:6.0pt'><b><span
style='font-size:8.0pt;font-family:Arial;color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
font-family:Arial;color:black'>xyz.c(1003) : warning 317: Incorrect operator: logical-not
(!) is not interchangeable with ones-complement (~).<br>
problem occurs in function 'SetMyProperty'<o:p></o:p></span></b></p>

<div style='mso-element:para-border-div;border:none;border-bottom:solid windowtext 1.0pt;
mso-border-bottom-alt:solid windowtext .5pt;padding:0in 0in 1.0pt 0in'>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext .5pt;
padding:0in;mso-padding-alt:0in 0in 1.0pt 0in'><b><span style='font-size:7.5pt;
font-family:Arial;color:black'><o:p>&nbsp;</o:p></span></b></p>

</div>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-size:8.0pt;
color:gray'>&nbsp;&nbsp;&nbsp;&nbsp;<span style='mso-spacerun:yes'>  
</span>1004<span style='mso-spacerun:yes'>          
</span>(!(DEVICE_MODE_1&nbsp;|&nbsp;DEVICE_MODE_2))){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1005&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pSrb-&gt;Status&nbsp;=&nbsp;STATUS_NOT_IMPLEMENTED;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>In this case, the code is supposed to detect if <b style='mso-bidi-font-weight:
normal'>PropertyInfo</b> contains anything other than the two DEVICE_MODE<span
style='mso-bidi-font-weight:bold'>s</span>. The test always is false because
the <b>! </b>operator returns 0 or 1, and zero in this case, presuming that at
least one of the DEVICE_MODEs is nonzero. This could be very difficult to find
in testing because getting any other bits into <b>PropertyInfo</b> could be
very difficult and is often not a test objective.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>Before trying to discuss some of the things PREfast can report, it is
worth a moment to discuss a possible source of confusion; PREfast analyzes
programs statically. It evaluates all the possible paths from any given point
in the program. That is, at each choice point in the program, it evaluates all
possibilities (less those it can eliminate based on information local to the
function.) For a given test, it can report on issues along both possible paths;
in some sense it appears that it simultaneously made both of two apparently
mutually exclusive choices. Because PREfast operates on one function at a time,
it doesn’t know about global state. Consequently, it may evaluate a path that,
given knowledge of global state, is impossible.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt;tab-stops:387.0pt'><span
style='font-family:Arial'>As an example, PREfast finds uses of uninitialized
variables that many compilers do not detect because it can analyze the flow of
control and detect paths where the variable is used without being initialized.
Detecting when <i style='mso-bidi-font-style:normal'>no</i> path initializes a
variable is fairly easy. PREfast can often detect when there is <i
style='mso-bidi-font-style:normal'>some</i> path that leaves the variable
uninitialized. (PREfast will also indicate what the path was, which compilers
do not.) However, it is not uncommon for PREfast to detect a potential path
that, given perfect knowledge of the state of the program, could not actually
occur. In this document this sort of result is called &quot;noise&quot; (false
positives). Noise is discussed in more detail in the section below.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>PREfast does not find every possible error, or all possible instances of
the kinds of issues it is written to detect. However, our experience has shown
that it is very useful for detecting certain classes of errors and that the
additional effort of using it and analyzing the results is warranted. In the
simplest cases, using PREfast involves prefixing your usual build command with
the keyword <b>prefast</b>, and then running <b>prefast view</b> to inspect
what it finds; the formal documentation, located in the DDK Help, gives the
details.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>To see what PREfast does and how it works, see the examples in the
%PREFAST_ROOT%\examples\ directory. Go to that directory in a DDK build
environment and type <b>prefast build -cZ</b>. Press ENTER, and then type <b>prefast
view</b>. This reports 33 defects. (The errors from the compiler are intended.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>The following illustration shows how PREfast fits into a typical build
environment. The build produces its usual results, but it also produces the
additional list of issues that can be used to improve your code.<o:p></o:p></span></p>

<p><b><span
style='font-size:10.0pt;font-family:Arial'><!--[if gte vml 1]><v:group id="_x0000_s1026"
 editas="canvas" style='width:441pt;height:209.25pt;
 mso-position-horizontal-relative:char;mso-position-vertical-relative:line'
 coordorigin="1102,2496" coordsize="11376,5396">
 <o:lock v:ext="edit" aspectratio="t"/>
 <v:shapetype id="_x0000_t75" coordsize="21600,21600" o:spt="75"
  o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
  <v:stroke joinstyle="miter"/>
  <v:formulas>
   <v:f eqn="if lineDrawn pixelLineWidth 0"/>
   <v:f eqn="sum @0 1 0"/>
   <v:f eqn="sum 0 0 @1"/>
   <v:f eqn="prod @2 1 2"/>
   <v:f eqn="prod @3 21600 pixelWidth"/>
   <v:f eqn="prod @3 21600 pixelHeight"/>
   <v:f eqn="sum @0 0 1"/>
   <v:f eqn="prod @6 1 2"/>
   <v:f eqn="prod @7 21600 pixelWidth"/>
   <v:f eqn="sum @8 21600 0"/>
   <v:f eqn="prod @7 21600 pixelHeight"/>
   <v:f eqn="sum @10 21600 0"/>
  </v:formulas>
  <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
  <o:lock v:ext="edit" aspectratio="t"/>
 </v:shapetype><v:shape id="_x0000_s1027" type="#_x0000_t75" style='position:absolute;
  left:1102;top:2496;width:11376;height:5396' o:preferrelative="f">
  <v:fill o:detectmouseclick="t"/>
  <v:path o:extrusionok="t" o:connecttype="none"/>
 </v:shape><v:line id="_x0000_s1028" style='position:absolute' from="4319,4729"
  to="7055,4729" strokecolor="#3cc" strokeweight="2.85pt">
  <v:stroke endarrow="block"/>
 </v:line><v:rect id="_x0000_s1029" style='position:absolute;left:10678;top:4079;
  width:1800;height:1293' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1030" style='position:absolute;left:10678;top:4077;
  width:1800;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">a.obj</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1031" style='position:absolute;left:10678;top:4509;
  width:1800;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">b.obj</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1032" style='position:absolute;left:11432;top:4943;
  width:300;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;
     font-family:Tahoma;color:black">…</span><span style="font-size:9.0pt;
     mso-bidi-font-size:12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1033" style='position:absolute;left:7055;top:4273;
  width:1440;height:934' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1034" style='position:absolute;left:7055;top:4523;width:1432;
  height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">cl</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1035" style='position:absolute;left:7055;top:5761;
  width:1440;height:934' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1036" style='position:absolute;left:7055;top:6009;width:1432;
  height:433' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">lib</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1037" style='position:absolute;left:7055;top:6958;
  width:1440;height:934' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1038" style='position:absolute;left:7055;top:7207;width:1432;
  height:433' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">link</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1039" style='position:absolute;left:10678;top:6239;
  width:1800;height:1293' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1040" style='position:absolute;left:10678;top:6236;
  width:1800;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">x.dll</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1041" style='position:absolute;left:10678;top:6668;
  width:1800;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">y.exe</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1042" style='position:absolute;left:10679;top:7102;
  width:1799;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">…</span><span style="font-size:9.0pt;mso-bidi-font-size:12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1043" style='position:absolute;left:1200;top:2654;
  width:1761;height:840' fillcolor="#bbe0e3" stroked="f"/>
 <v:rect id="_x0000_s1044" style='position:absolute;left:1200;top:2654;width:1761;
  height:840' fillcolor="#3cc" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1045" style='position:absolute;left:1200;top:2855;width:1664;
  height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">prefast</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1046" style='position:absolute;left:2160;top:4129;
  width:2159;height:1200' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1047" style='position:absolute;left:2160;top:4297;width:2159;
  height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">Build.exe</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1048" style='position:absolute;left:2160;top:4729;
  width:2159;height:435' filled="f" stroked="f">
  <v:textbox inset="0,0,0,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<span style="font-size:14.0pt;mso-bidi-font-size:18.0pt;font-family:Tahoma;
     color:black">Msdev</span><span style="font-size:9.0pt;mso-bidi-font-size:
     12.0pt"><o:p></o:p></span></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1049" style='position:absolute;left:4679;top:4249;
  width:1589;height:936' fillcolor="#3cc" stroked="f">
  <v:textbox inset="0,,0">
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align:center">
			<b style="mso-bidi-font-weight:normal">
			<span style="font-family:Arial">cl<o:p></o:p></span></b></p>
			<p class="MsoNormal" align="center" style="text-align:center">
			<b style="mso-bidi-font-weight:normal">
			<span style="font-family:Arial">intercept<o:p></o:p></span></b></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1050" style='position:absolute;left:4679;top:4249;
  width:1589;height:936' filled="f" strokeweight=".7pt"/>
 <v:rect id="_x0000_s1051" style='position:absolute;left:10679;top:2653;
  width:1799;height:985' fillcolor="#3cc" strokeweight=".7pt">
  <v:textbox>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal"><b style="mso-bidi-font-weight:normal">
			<span style="font-family:Arial">PREfast<o:p></o:p></span></b></p>
			<p class="MsoNormal" align="center" style="text-align:center">
			<b style="mso-bidi-font-weight:normal">
			<span style="font-family:Arial">log<o:p></o:p></span></b></p>
		</div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:line id="_x0000_s1052" style='position:absolute;flip:y' from="6268,3174"
  to="10679,4396" strokecolor="#3cc" strokeweight="3pt">
  <v:stroke endarrow="block"/>
 </v:line><v:line id="_x0000_s1053" style='position:absolute;flip:y' from="8495,4729"
  to="10679,4732" strokecolor="#3cc" strokeweight="2.85pt">
  <v:stroke endarrow="block"/>
 </v:line><v:line id="_x0000_s1054" style='position:absolute' from="8495,6236"
  to="10679,6833" strokecolor="#3cc" strokeweight="2.85pt">
  <v:stroke endarrow="block"/>
 </v:line><v:line id="_x0000_s1055" style='position:absolute;flip:y' from="8495,6833"
  to="10679,7414" strokecolor="#3cc" strokeweight="2.85pt">
  <v:stroke endarrow="block"/>
 </v:line><v:shape id="_x0000_s1056" style='position:absolute;left:3209;top:5330;
  width:3846;height:910;mso-wrap-style:square;mso-wrap-distance-left:9pt;
  mso-wrap-distance-top:0;mso-wrap-distance-right:9pt;
  mso-wrap-distance-bottom:0;mso-position-horizontal:absolute;
  mso-position-horizontal-relative:text;mso-position-vertical:absolute;
  mso-position-vertical-relative:text;v-text-anchor:top' coordsize="2980,705"
  path="m,l,705r2980,-3e" filled="f" strokecolor="#3cc" strokeweight="2.85pt">
  <v:stroke endarrow="block"/>
  <v:path arrowok="t"/>
 </v:shape><v:shape id="_x0000_s1057" style='position:absolute;left:3209;top:6236;
  width:3846;height:1178;mso-wrap-style:square;mso-wrap-distance-left:9pt;
  mso-wrap-distance-top:0;mso-wrap-distance-right:9pt;
  mso-wrap-distance-bottom:0;mso-position-horizontal:absolute;
  mso-position-horizontal-relative:text;mso-position-vertical:absolute;
  mso-position-vertical-relative:text;v-text-anchor:top' coordsize="2980,913"
  path="m,l,913r2980,e" filled="f" strokecolor="#3cc" strokeweight="2.85pt">
  <v:stroke endarrow="block"/>
  <v:path arrowok="t"/>
 </v:shape><v:polyline id="_x0000_s1058" style='position:absolute;
  mso-wrap-style:square;mso-wrap-distance-left:9pt;mso-wrap-distance-top:0;
  mso-wrap-distance-right:9pt;mso-wrap-distance-bottom:0;
  mso-position-horizontal:absolute;mso-position-horizontal-relative:text;
  mso-position-vertical:absolute;mso-position-vertical-relative:text;
  v-text-anchor:top' points="2961,3058,3111,3058,3111,3849" coordsize="150,791"
  filled="f" strokeweight="3.1pt">
  <v:stroke endarrow="block"/>
  <v:path arrowok="t"/>
 </v:polyline></v:group><![endif]--><![if !vml]><img width=591 height=280
src="drvfast_install_files/image001.gif" v:shapes="_x0000_s1026 _x0000_s1027 _x0000_s1028 _x0000_s1029 _x0000_s1030 _x0000_s1031 _x0000_s1032 _x0000_s1033 _x0000_s1034 _x0000_s1035 _x0000_s1036 _x0000_s1037 _x0000_s1038 _x0000_s1039 _x0000_s1040 _x0000_s1041 _x0000_s1042 _x0000_s1043 _x0000_s1044 _x0000_s1045 _x0000_s1046 _x0000_s1047 _x0000_s1048 _x0000_s1049 _x0000_s1050 _x0000_s1051 _x0000_s1052 _x0000_s1053 _x0000_s1054 _x0000_s1055 _x0000_s1056 _x0000_s1057 _x0000_s1058"><![endif]></span></b><b><span
style='font-size:10.0pt;font-family:Arial'><o:p></o:p></span></b></p>

<h2>Noise (False Positives)</h2>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>Some issues that PREfast reports are obviously errors, but others are
clearly not errors. In some cases, PREfast reports issues that the programmer
knows cannot actually occur. This situation is particularly likely when global
state is involved.<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>Using the example of uninitialized variables: often, a variable is
initialized only in a loop. If the loop is executed at least once, then the
variable will be initialized. However, if the path where the loop is executed
zero times is being evaluated, the variable will not be initialized. Because
PREfast has no idea about global state, it often has no way of determining that
zero executions is impossible because of some constraint on the global state,
and it will report that the variable is thus potentially used when not
initialized.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>This is an example of noise: the problem is not real if at least one
execution of the loop is guaranteed. However, it does point out an assumption
made by the programmer that might or might not actually be justified. If the
assumption is justified, adding an assertion is good practice; it tells
subsequent programmers that someone thought about the issue. If the assumption
proves actually to be false, a checked build is likely to diagnose the problem
in a way that is far less likely to be obscure and hard to find. If the
assumption is not justified, the code should be changed.</span><a
style='mso-footnote-id:ftn1' href="#_ftn1" name="_ftnref1" title=""><span
class=MsoFootnoteReference><span style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-fareast-language:
EN-US;mso-bidi-language:AR-SA'>[1]</span></span><![endif]></span></span></a><span
style='font-family:Arial'><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>A common source of noise is reporting the same situation, in a slightly
different context, repeatedly. For example, if the same uninitialized variable
is used more than once, each use reports a warning. Thus, a single code change
may remove a number of warnings.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>To be useful, a tool like this must strike a balance between too many
reports (being too noisy) and too few reports (missing possible errors).
Effective use of PREfast must take that balance into account. Each warning must
be evaluated on its own merits: some need to be acted upon, some ignored. Good
programming judgment and careful use of comments or other appropriate records
will make it easier to determine whether your PREfast results are noise or
reflect actual defects.</span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<h2>Quieting Noise</h2>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>There are a number of ways to quiet the noise. One way is to use the
filters in the viewer to not display certain classes of warning. This makes sense
when the risk associated with the warning is low or the noise level is high.
Each user or organization has to decide which warnings to ignore, particularly
because variations in coding styles also cause variations in what is reported.
(See the <b>Filters</b> button in the viewer.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>The WINPFT filter is used when focusing on system security. The warnings
passed through by WINPFT are a very good place to start because they identify
particularly high seriousness, low-noise warnings. From there, you can determine
for yourself which specific warnings to turn on and off.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>In many cases, a trivial (but in the strictest sense unnecessary) code
change is the best way to suppress noise. For example, adding an ASSERT,
initializing a variable at the point of declaration, or slightly rearranging
code can reduce false positives.<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>PREfast detects a number of classes of &quot;parenthesization
error&quot; (errors in use of parentheses or similar syntactic misuses) where
what was coded may not be what was intended because of the precedence rules of
C. In those cases where the warning is not pointing out a real problem, adding
parentheses can help with future maintainability of the program, as well as
reducing false positives in PREfast.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>A #pragma can also be used to address specific cases of noise. For more
information, see “Suppressing Individual Warning Messages” in the Warning
Message Reference of the PREfast Help file (located in the DDK documentation).<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<h2>Experience with driver source code</h2>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>PREfast was run on a large number of drivers. Those warnings beyond
those passed through by the default filter (WINPFT) were informally analyzed
for noise. The warnings passed through by WINPFT should be fixed, so they are
not discussed further in this document.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'>Below are some notes on interesting results from that analysis. Because
the results partially depend on coding style, you may or may not observe the
same patterns. These notes are intended to be a guide to using the tool, not to
be an exhaustive or detailed list of the possible errors. The warnings below
are a summary only. The PREfast Help file contains a far more thorough
description of the meaning of all the warnings; see that file, which is
included in the DDK documentation, if further explanation of the cause of the
warning is needed.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 1: Uninitialized variable<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>Although
the number of reported warnings for this issue was fairly high, most of the
problems were potential noise because PREfast assumed that a loop might be
executed zero times. The critical point here is that the noise was potential;
someone with a thorough global knowledge of the driver would have to confirm
that executing the loops zero times is in fact impossible. Usually a single
root cause yielded several duplicate reports from PREfast.<span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>When
the failure was not such a loop, about half the remaining reports were noise.
In most cases it only took a few minutes to find the problem or eliminate it as
noise.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>Another
common source of this warning was bulletproofing code (code intended to protect
against the unexpected) that was not coded correctly.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><span
style='mso-tab-count:1'>            </span></span>if (NULL != somevar) {</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'>    </span>status = someFunction(somevar);</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='mso-tab-count:1'>      </span>}</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='mso-tab-count:1'>      </span>return
status;</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>The
variable <b style='mso-bidi-font-weight:normal'>status</b> should be
initialized to some appropriate value or the program converted to use an if/else.
(It is often better for a driver to fail soft in this type of situation, so the
otherwise obvious ASSERT may not be the best method.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>For
the examples investigated, this warning occurred frequently (with many
duplicates), but also indicated some potentially serious problems that
justified further investigation. The issues are usually easily dealt with, so
the relatively high noise of this report is not a major inconvenience.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 11: Dereferencing NULL pointer<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurs frequently. Sometimes it occurs in situations that the
programmer judged to be highly unlikely, but that are not handled quite
correctly. Some examples:<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt;text-indent:-.25in;mso-list:l0 level1 lfo2;
tab-stops:list 66.0pt'><![if !supportLists]><span style='font-family:Arial;
mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:Arial'>An allocation
fails; subsequent cleanup code (usually in a distant part of the function)
references the NULL pointer while cleaning up from a more likely error.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt;text-indent:-.25in;mso-list:l0 level1 lfo2;
tab-stops:list 66.0pt'><![if !supportLists]><span style='font-family:Arial;
mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:Arial'>A pointer and
what it references are both checked for NULL correctly, but a debug/warning
message is printed using the pointer that might be NULL.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt'><span style='font-family:Arial'>For
example if <i style='mso-bidi-font-style:normal'>somevar</i> below happens to
be NULL:<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt'>if (NULL == somevar || NULL ==
somevar-&gt;bar)</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt'><span
style='mso-spacerun:yes'>    </span>printf(“Bad arg somevar or somevar-&gt;bar
%p %p\n”, </p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt'><span
style='mso-spacerun:yes'>            </span>somevar, somevar-&gt;bar);<span
style='mso-spacerun:yes'>  </span>// references NULL somevar</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning often occurs under situations similar to Warning 1 (uninitialized
variable), except that initialization has occurred (to NULL).<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>User-written
functions that do not return (but rather exit by throwing an exception or
aborting) can sometimes mislead the analysis for this warning. Currently, there
is no good way to deal with this problem.<span style='mso-spacerun:yes'> 
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>If
an argument to a function is tested for NULL, it is more prone to be discovered
as having this error, so code like the example below often causes false
warnings:<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><span
style='mso-tab-count:1'>            </span></span>if (NULL == argn)</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'>   </span>functionThatDoesNotReturnButComplains();</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span
style='mso-spacerun:yes'>      </span>x(argn-&gt;somevar);<span
style='mso-spacerun:yes'>  </span>// reports accessing a NULL</p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>For
the samples used, this warning was high frequency and high noise, but much of
the noise was due to <span style='mso-bidi-font-weight:bold'>noreturn</span>
functions that could easily be ignored. After eliminating the <span
style='mso-bidi-font-weight:bold'>noreturn</span> functions, the noise level
was quite tolerable, and the failures it discovered were very frequently
failures that do not show up in testing because they are (nearly) impossible to
cause. Many of the failures were associated with fail-soft or debug code that
still inadvertently referenced the NULL.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 14: Leaking memory<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning can often be mislead while processing allocator functions that are part
of the driver.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>The
warning is low frequency and high noise, but it is a high risk when not in an
allocator function.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 31: Return value ignored (at
the point of call)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>There
are two common reasons for this warning: <o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt;text-indent:-.25in;mso-list:l2 level1 lfo4;
tab-stops:list 66.0pt'><![if !supportLists]><span style='font-family:Arial;
mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:Arial'>Calling
functions that rarely fail, but which could fail in theory (for example, string
functions that allocate memory). Much code simply ignores that possibility.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:66.0pt;margin-bottom:.0001pt;text-indent:-.25in;mso-list:l2 level1 lfo4;
tab-stops:list 66.0pt'><![if !supportLists]><span style='font-family:Arial;
mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:Arial'>The scanf family
of functions can fail due to incorrect input.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred frequently. The reports are uniformly accurate, but the
developer may deem many cases unimportant depending on the context and the
function being called.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 63-67: Format string mismatch<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred rarely for drivers but it was typically accurate. If the
mismatch is for a string argument it could cause a crash or security problem.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 69: Inefficient use of function<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning usually reflects the use of a <b>printf</b>-like function instead of a
simpler function (such as a copy). In general, this is an efficiency
consideration, although there may be buffer overrun issues to consider as well.
This warning occurred with moderate frequency.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 203: Buffer overrun (known
size)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>When
this warning refers to <b style='mso-bidi-font-weight:normal'>memcpy</b> or
similar functions (count based), it is highly accurate. When this warning is
reported on a null-terminated-string copy from a larger to a smaller buffer,
more analysis is required to determine if it is noise or not. If it is known
that the actual length of the content of the larger buffer is never too large,
then there is not a real problem; otherwise, it could reflect a potentially
serious problem.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred a few times during testing.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 204: Possible buffer overrun<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred with moderate frequency. It is potentially high noise for
drivers. This warning detects copying a null-terminated string into a
fixed-size buffer without checking the size of an input parameter, which may be
known from context to be safe. If it is not known to be safe, this warning
indicates a dangerous bug.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 209: Using sizeof(variable)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurs when a wide character buffer is passed along with a sizeof() that
appears to reflect the size of the buffer. Some functions that take wide
characters take character counts, some take byte counts.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred fairly often and was mostly noise. However, some real problems
were identified. Because the name of the called function appears in the message
list, it is easy to eliminate uninteresting situations by simply looking at the
name of the called function. (A call to a wcs... function is probably an
error.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 214-230 (except 221): Cast
between semantically different integer types<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings are infrequent, but are usually valid and primarily result from misuse
of HRESULT types. The BOOL/HRESULT mismatches are particularly a concern
because </span><span style='font-family:Courier;mso-bidi-font-family:Arial'>S_OK
== FALSE</span><span style='font-family:Arial'>, so the program may do the
opposite of what the programmer intended.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 221: Implicit cast between
semantically different integer types<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>Warning
221 is a special case of warnings 214-230. It occurs fairly frequently and is
very noisy because tests for specific HRESULT are detected and reported.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 244 - 246: Local declaration
hides global/outer scope<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings are highly accurate and occur with moderate frequency. If the source
code is correct, these warnings do not indicate bugs, but the situation is
dangerous because maintenance errors are much more likely to occur.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 249,250,252,253,261: (various)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings were not observed, but they are kernel specific, so they should be
investigated.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 255: _alloca indicates failure<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning is rare and accurate. However, it may not indicate a real problem (that
needs to or can be fixed). The warning indicates an unchecked call to _alloca
that could fail if the thread runs out of stack. Particularly for drivers, this
issue needs to be considered carefully, although not many drivers use
_alloca().<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 262: This function uses nnnn
bytes of stack<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning is rare and accurate. It indicates that rewriting to reduce stack usage
should be considered. For drivers in particular, setting /STACKHOGTHRESHOLD (which
controls the frame size threshold (nnnn)) to a smaller value may be
particularly valuable. <o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 263: Using _alloca in a loop<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning is rare but accurate. It may indicate a potentially serious stack
runaway that could be data dependent and, thus, very hard to find in testing.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 270-274, 284: Format string
mismatch<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings occur occasionally, are accurate, and probably indicate a real
problem. However, for drivers the most likely consequence of this issue is that
debug output is printed incorrectly. Some mismatches could cause crashes.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 278-279, 283: Allocation/free
mismatch<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning is C++ specific, indicating that scalar versus array new and delete are
improperly mixed.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 280: Allocation/free mismatch<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning indicates that the allocator of an object does not appear to match the
function freeing it. The warning occurs occasionally and can be mislead by the
use of helper function on either the allocate or free. It also detects when C++
new/delete are mixed with malloc()/free(). The text in the message list is
complete enough to quickly eliminate safe combinations.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 285-286: Short-circuit
evaluation may be incorrect<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was not observed, so it is presumably rare in drivers. If it is observed
and not used as a means to disable dead code, this warning may indicate a
hard-to-find coding error.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 291-296: For loop<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was not observed, so it is presumably rare in drivers. It would also
indicate a particularly obscure coding error if it passed testing at all.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 297: Shift before widening to
64 bit<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred infrequently and may not actually reflect a problem, but the
warning often implicitly asks why a particular field is 64 bits. This warning
is easily quieted with a (necessary, in many cases) cast that causes widening
to 64 bits to occur earlier.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 300: Discarded result<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurs occasionally; it can be the result of the benign use of a macro
that returns a value. If it was intended, then it can be quieted with a (void)
cast.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 301: Deprecated function<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>Not
all deprecated functions (functions that are obsolete or being phased out) are
caught at this time. However, when this warning occurs, the code should be rewritten
to use the replacement function.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 302-303: Format string mismatch<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning results from mixing wide and narrow characters inappropriately. It is
rare, accurate, and well worth fixing because the results will certainly be
wrong and might cause a crash.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 304: Address of variable<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
indicates that the address-of operator (<b>&amp;</b>) is used in a context
where it is redundant. The warning occurs occasionally. Some coding styles use this
redundancy as emphasis to indicate that an address is being passed, but it can
also indicate that the code is not what was intended.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 307: Cast between semantically
different string types<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>Mixing
BSTR and wchar * can be dangerous. This warning was not observed outside a
single driver that mixed these string types frequently but cautiously.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 309: Potential NULL argument to
function<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was rare. It was observed when an explicit 0 was passed, but usages
appear to be correct, if very unusual.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 310 - 312: (various)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings were not observed, but should be investigated if observed.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><span
style='mso-tab-count:1'>            </span><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 313-317: Incorrect
order/incorrect operator<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings occur rarely, but when they do occur, they very frequently indicate a
programmer error. (For example, testing a zero-valued flag constant with a
bitwise operator, or confusing <b style='mso-bidi-font-weight:normal'>!</b> and
<b style='mso-bidi-font-weight:normal'>~</b> when testing flags.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 318: Degenerate __try/__except<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was not observed, but it should be investigated if reported.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 319: Dead code associated with
comma operator<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was very rare, but the observed failures indicated code that probably
did not do what the programmer intended.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 322: Empty _except block<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurs rarely, and code being reported appeared to do this
intentionally. It appeared the objective was to ignore the exception, allow the
filter to do all the work.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 323-324: (various)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was not observed.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 325: Potential comparison of
BSTR with NULL<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred with moderate frequency, potentially high noise. (Functions
which allocate BSTRs can return NULL if the allocation fails; code that tests
for that allocation failure gets this warning.)<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 326: Potential comparison of
constant with constant<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred occasionally, and it usually was associated with comparing
symbolic constants or sizeof values, and thus benign. When occurrences of this
warning conflict with an organizations’ style guidelines, they can be ignored..<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 327: Possible buffer overrun<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was not observed, but it should be fixed if found; a buffer overrun is
an error and could cause a crash.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 328: Type passed<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>The
<b>is</b>* (isdigit, for example) functions take <b>int</b> arguments, but a
signed char (which might be sign extended) is passed. In many cases this is
safe, but if a negative value is passed, the sign extension may cause an
unexpected result (including possible buffer overruns in the <b>is</b>*
function). This warning applies to other functions besides the <b>is</b>*
functions, but rarely actually occurs for them. This warning occurred
occasionally.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 329-333: (various)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings were not observed. They should be evaluated if they occur because the
error is highly context dependent.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 334: The sizeof operator
applied to an expression...<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning indicated the misuse of <b style='mso-bidi-font-weight:normal'>sizeof</b>,
resulting in a situation that might cause string overflow. It occurred rarely.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 380, 381, 382: (various)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>These
warnings were not observed. It is unlikely that they appear in drivers.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 400: Case insensitive case
comparison to constant string<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning occurred relatively infrequently. Case insensitive string comparisons can
be a problem if there is any possibility that user-provided data contain
characters outside the range from 0-0x7f or when operating outside of the
default locale. This issue is unlikely in drivers, but if user-provided path
names are being examined, it is possible and should be examined much more
closely.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Warning 401: Case insensitive
comparison to constant string in default locale<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-top:0in;margin-right:21.1pt;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt'><span style='font-family:Arial'>This
warning was not observed. See Warning 400 for comments.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><span style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<span style='font-size:10.0pt;font-family:Arial;mso-fareast-font-family:"Times New Roman";
mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA'><br
clear=all style='mso-special-character:line-break;page-break-before:always'>
</span>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><b style='mso-bidi-font-weight:
normal'><i style='mso-bidi-font-style:normal'><span style='font-size:14.0pt;
font-family:Arial'>Additions for the first driver-specific version of PREfast.<o:p></o:p></span></i></b></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>This
section summarizes the changes for the DDK version of PREfast since the Windows
2003 Server release.<span style='mso-spacerun:yes'>  </span>This version of
PREfast is specifically tuned for use on drivers, particularly
kernel-mode drivers.<span style='mso-spacerun:yes'>  </span>Running it on
non-driver code results in an increased number of false reports of errors.<span
style='mso-spacerun:yes'>  </span>Running it on user-mode drivers is very
useful, but you need to ignore the kernel-mode specific errors that PREfast reports.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Many of the
new rules have not been applied to all possible instances where they in
principle apply; that is expected to be done over time.<span
style='mso-spacerun:yes'>  </span>When investigating a report from PREfast,
developers should consider that similar errors may not have been detected, and
should consider whether there are other locations which should be similarly
corrected.<span style='mso-spacerun:yes'>  </span>A clean PREfast run will
never mean that the driver is error-free, but this version will catch many
additional common errors.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Many
existing rules have been applied to driver-specific functions, including
flagging obsolete interfaces and detecting null arguments.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:
normal'><span style='font-size:10.0pt;font-family:Arial'>Running PREfast for
Drivers<o:p></o:p></span></i></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:
normal'><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></i></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>To run the
driver-specific version of PREfast, run <B>drvfast.cmd</B> (instead of <B>setenv.bat</B>) with
the same parameters that you would use for <B>setenv.bat</B>.<span style='mso-spacerun:yes'> 
</span>The Drvfast.cmd script calls Setenv.bat with the parameters that you specify. Thereafter, whenever you submit a <B>prefast</B> command, it starts the driver-specific version of PREfast.<span style='mso-spacerun:yes'> 
</span>If you do not use the <B>drvfast.cmd</B>, the generic (not driver-specific) version
of PREfast starts.<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:
normal'><span style='font-size:10.0pt;font-family:Arial'>New Rules</span></i></b><span
style='font-size:10.0pt;font-family:Arial'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>The
following are new rules or rules with changed behaviors for the driver specific
version of PREfast.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warnings 1, 11, 14, 211: Memory
leaks, NULL pointer dereference, and uninitialized memory access.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>(A few other rare rules are also affected by this change.)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The meaning of these rules has not changed, but the method
by which these errors are found has been refined to more accurately simulate
the flow of control of the program.<span style='mso-spacerun:yes'>  </span>A
major change to the logic is the ability to handle functions that return
resources in their arguments and a success indication separately. (Those are
generally reported with the new error numbers below).<span
style='mso-spacerun:yes'>  </span>Additional changes in handling the
consequences of various flow-of-control statements will cause some new errors
to be detected, old errors to be detected in new ways, and many old false
positives to no longer be reported.<span style='mso-spacerun:yes'>  </span>Some
new false positives are to be expected as well, although many of those are ones
where a programmer would have the same concern from code inspection.<span
style='mso-spacerun:yes'>  </span>(Specifically, more instances of loops which
are executed zero times and which initialize variables if they are executed at
least one time, are found.<span style='mso-spacerun:yes'>  </span>Neither a
programmer nor PREfast can know, from inspection of just that function, if it
is impossible for the loop to execute zero times.)<span
style='mso-spacerun:yes'>  </span>Redundant reports of uninitialized variables
and null dereferences have been suppressed, with the risk that occasionally
only one of several distinct causes may be reported.<span
style='mso-spacerun:yes'>  </span>(Re-running PREfast after fixing problems
will expose those.)<span style='mso-spacerun:yes'>   </span>Both this version
and the prior version of PREfast can follow “impossible” paths through switch
statements.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>The
test for functions returning resources through their arguments was specifically
implemented for </span><span style='font-size:10.0pt;font-family:"Courier New"'>NTSTATUS</span><span
style='font-size:10.0pt;font-family:Arial'>-valued functions. However, not all
code tests </span><span style='font-size:10.0pt;font-family:"Courier New"'>NTSTATUS</span><span
style='font-size:10.0pt;font-family:Arial'> correctly.<span
style='mso-spacerun:yes'>  </span>It is generally incorrect to test explicitly
for </span><span style='font-size:10.0pt;font-family:"Courier New"'>STATUS_SUCCESS</span><span
style='font-size:10.0pt;font-family:Arial'>, but rather the </span><span
style='font-size:10.0pt;font-family:"Courier New"'>NT_SUCCESS</span><span
style='font-size:10.0pt;font-family:Arial'> macro should be used.<span
style='mso-spacerun:yes'>  </span>Some false positives are generated because
subsequent tests for success are incorrectly coded.<span
style='mso-spacerun:yes'>  </span>Specifically, explicit tests for </span><span
style='font-size:10.0pt;font-family:"Courier New"'>STATUS_SUCCESS</span><span
style='font-size:10.0pt;font-family:Arial'> permit some successful returns to
appear to reach error exits and unsuccessful returns to proceed as if they were
successful.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.75in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:Arial'>In general (there are a few documented exceptions) the
following is the correct way to code tests of functions returning NT_STATUS;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'>status = IoAttachDevice(…);<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'>if (!NT_SUCCESS(res)) {<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span>/* handle
error */<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'>}<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>The
more accurate tests for flow of control can be mislead by tests involving
structure members or other objects which are not simple variables.<span
style='mso-spacerun:yes'>  </span>It may upon occasion simulate impossible
paths, but also finds many new possible errors.<span style='mso-spacerun:yes'> 
</span>Simulation of impossible paths should be ignored.<span
style='mso-spacerun:yes'>  </span>(As an example, two </span><span
style='font-size:10.0pt;font-family:"Courier New"'>if</span><span
style='font-size:10.0pt;font-family:Arial'> statements with conditions like</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.75in'><span style='font-size:10.0pt;
font-family:Arial'><span style='mso-spacerun:yes'>     </span></span><span
style='font-size:10.0pt;font-family:"Courier New"'>(p-&gt;member.submember !=
q-&gt;member.submember)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.75in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>   </span></span><span
style='font-size:10.0pt;font-family:Arial'>are likely to cause this problem.)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>Since
drivers are more prone than other code to use inline assembler, it should be
noted that PREfast treats inline assembler as if it were the end of the flow of
control in a function (as if a return or throw were reached).<span
style='mso-spacerun:yes'>  </span>This will suppress some warnings.<span
style='mso-spacerun:yes'>  </span>Putting the assembler in an </span><span
style='font-size:10.0pt;font-family:"Courier New"'>__inline</span><span
style='font-size:10.0pt;font-family:Arial'> function will usually address the
problem and allow PREfast to analyze the rest of the function.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>This
version of PREfast treats function calls in </span><span style='font-size:10.0pt;
font-family:"Courier New"'>if</span><span style='font-size:10.0pt;font-family:
Arial'> statements slightly differently than previously.<span
style='mso-spacerun:yes'>  </span>Functions are now assumed to return a
different value with each call (as would be the case for functions which access
hardware) as opposed to the same value with each identical call. This
occasionally will cause PREfast to follow an “impossible” path. (Details: Prior
versions determined that two function calls were “identical” if those arguments
which were not literal constants were the same.<span style='mso-spacerun:yes'> 
</span>For drivers which test hardware state this proved to be inaccurate
enough to suppress a number of valid errors.)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>Convenience
or “wrapper” functions can cause many false reports for these rules.<span
style='mso-spacerun:yes'>  </span>The following example will report a false
leak of the lock:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>myAcquireMutex(PFAST_MUTEX mutex)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>{<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>   
</span>ExAcquireFastMutex(mutex);<span style='mso-spacerun:yes'>  </span>/*
presumably other housekeeping is done */<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>These
changes also affect ASSERT macros.<span style='mso-spacerun:yes'>  </span>Some
ASSERT macros can continue past the assert, and some use functions not known to
PREfast to terminate execution.<span style='mso-spacerun:yes'>  </span>It is worthwhile
to understand the exact ASSERT macro in use if PREfast continues past an ASSERT
when compiling with ASSERTs enabled.<span style='mso-spacerun:yes'>  </span>If
a function is called that PREfast does not know terminates execution, it can be
marked with __declspec(noreturn) (see the language reference) to indicate that
the function will not return.<span style='mso-spacerun:yes'>  </span>PREfast
does attempt to determine if an ASSERT is being used, but it is not always
successful.<span style='mso-spacerun:yes'>  </span>__declspec(noreturn) is far
more reliable.<span style='mso-spacerun:yes'>  </span>The following example
requires the declspec to be recognized as an assert.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'>__declspec(noreturn) myAssertHandler(char *);<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'>#define myAssert(x, message)
((!x)myAssertHandler(message))<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 262: This function uses NNNN
bytes of stack: exceeds /StackHogThreshold=1024.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Maximum stack threshold has been lowered significantly due
to the limited stack space available to kernel-mode drivers.<span
style='mso-spacerun:yes'>   </span>For user-mode drivers, larger values are
acceptable but may or may not be desirable.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 311: <span
class=warningattop>Consider using '&lt;function or feature&gt;' instead of
'Function'. Reason: &lt;reason, usually obsolete&gt;.</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Functions are marked obsolete with respect to the most
current version of the Windows DDK.<span style='mso-spacerun:yes'> 
</span>Drivers written to operate on older releases may need to continue to use
obsolete interfaces.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8101: The Drivers module has
inferred that the current function is a &lt;Function Name Type&gt; function.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is a strictly informational message, and by itself can
be ignored.<span style='mso-spacerun:yes'>  </span>However, certain other
driver specific rules are enabled when PREfast determines that the function
might be one of a number of classes of function (usually used as
callbacks).<span style='mso-spacerun:yes'>  </span>PREfast determines this from
the argument and result types used by the function, and possibly further
refined by the function’s name.<span style='mso-spacerun:yes'>  </span>This is
only an approximation, and false warnings can be generated if the function is
not what was inferred.<span style='mso-spacerun:yes'>  </span>However, many of
the inferences have proven to be valid and useful.<span
style='mso-spacerun:yes'>  </span>This message exists to clarify other
messages.<span style='mso-spacerun:yes'>  </span>It should never be recorded as
a bug, but is useful to display when investigating bug reports in the viewer.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8102: &lt;reserved&gt;<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8103: Leaking the resource
stored in &lt;name&gt;.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This indicates that it appears that a resource other than
memory (such as a lock or Windows Resource object) is being leaked.<span
style='mso-spacerun:yes'>  </span>If the object being leaked is represented in
a variable (in the same way that allocated memory is) then the value of name is
that variable.<span style='mso-spacerun:yes'>  </span>If the object being
leaked (such as a spin lock) is anonymous or simply named by an expression, the
value of &lt;name&gt; will encode the object name.<span
style='mso-spacerun:yes'>  </span>For example, if the cancel lock appears to be
leaking, &lt;name&gt; will be “</span><span style='font-size:10.0pt;font-family:
"Courier New"'>CancelLock:</span><span style='font-size:10.0pt;font-family:
Arial'>” (note the : ).<span style='mso-spacerun:yes'>  </span>These resources
are generally allocated via functions that return the resource through a
parameter.<span style='mso-spacerun:yes'>  </span>In a few instances, the
resource is not returned, but rather must be passed on via some other operation
(such as calling IoAttachDevice after calling IoCreateDevice.)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Note: it is common to find that “wrapper functions” are used
around many resource-allocating functions.<span style='mso-spacerun:yes'> 
</span>At this time, these will yield false positives that can be ignored.<span
style='mso-spacerun:yes'>  </span>If the wrapper functions are not used
correctly, undetected leaks can still occur.<span style='mso-spacerun:yes'> 
</span>Functions which are entered and exit with a resource held, but which
release and reacquire it can also yield noise.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8104: Possibly leaking
memory &lt;pointer&gt;.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is a moderately speculative report, and should often be
ignored.<span style='mso-spacerun:yes'>  </span>It indicates that PREfast
believes there might be a leak, but that the memory object could have been
passed to a function that might have freed it or added it to some global
structure, but that PREfast cannot be sure.<span style='mso-spacerun:yes'> 
</span>If it is known that the memory is handled in that way, the error should
be ignored.<span style='mso-spacerun:yes'>   </span>However, if the memory
should be being freed by the current routine, this indicates a valid leak.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8105: Leaking resource in
&lt;pointer&gt; due to an exception<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is an analog to 8103 above, except that the point of
the leak is an exception rather than function return.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8106:</span> </b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
Arial'>Possibly leaking memory &lt;pointer&gt; due to an exception.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is similar to both 8104 and 8105.<span
style='mso-spacerun:yes'>  </span>It speculates that a leak could be occurring,
but the point of the leak is an exception.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8107: The resource
&lt;variable&gt; must be held when calling this function.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This indicates that a function must be called with a
particular resource held.<span style='mso-spacerun:yes'>  </span>Holding the
critical region lock when using Windows NT Resource Objects is an example.<span
style='mso-spacerun:yes'>  </span>This is quite reliable in straightforward
code, but can be mislead by the use of wrapper functions.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8108: The argument &lt;variable&gt;
is being passed to a function that expects a pointer to an object (not a
pointer to a pointer).<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Certain functions are “polymorphic” by taking a PVOID
argument.<span style='mso-spacerun:yes'>  </span>A pointer to a pointer is a
legal PVOID object, so it is easy to mis-code </span><span style='font-size:
10.0pt;font-family:"Courier New"'>pXXX</span><span style='font-size:10.0pt;
font-family:Arial'> as </span><span style='font-size:10.0pt;font-family:"Courier New"'>&amp;pXXX</span><span
style='font-size:10.0pt;font-family:Arial'> and not have the compiler detect
it.<span style='mso-spacerun:yes'>  </span>If the size of a pointer is
intended, use the size of the type of the pointer object, rather than the size
of the pointer object itself.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8109: The resource
&lt;name&gt; cannot be held at the time this function is called.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is the converse of 8107.<span
style='mso-spacerun:yes'>  </span>It is in particular used to deal with taking
the same lock twice.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8110:<span
style='mso-spacerun:yes'>  </span>Drivers must protect floating point hardware
state.<span style='mso-spacerun:yes'>  </span>See use of float
&lt;expression&gt;.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Inside driver and kernel code, the use of floating point
without protecting it with the appropriate function calls can lead to very hard
to explain crashes and/or data corruption.<span style='mso-spacerun:yes'> 
</span>If the Drivers module is applied to non-kernel-mode code, this message
is 100% noise.<span style='mso-spacerun:yes'>  </span>Otherwise it is reliable,
except that if the use of floating point crosses function boundaries it can
report false positives.<span style='mso-spacerun:yes'>  </span>Given the
extremely hard-to-detect and very significant consequences of this, it is worth
taking the extra time to be sure that no valid instances of this remain.<span
style='mso-spacerun:yes'>  </span>Code that does not check the result from the
save operation my report this error on the assumption that the save operation
failed.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8111: The IRQL where the
floating point state was saved does not match the current IRQL (for this restore
operation).<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>When floating point state is saved and restored, the IRQL at
the point of save and restore must be the same.<span
style='mso-spacerun:yes'>   </span>PREfast, within its abilities, tries to
track the IRQL and detect when this requirement is not met.<span
style='mso-spacerun:yes'>  </span>However, PREfast cannot always successfully
track the IRQL, and will not report this problem unless it is likely that there
is a problem.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>See also 8120-8123.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8112:<span
style='mso-spacerun:yes'>  </span>A variable (&lt;name&gt;) which is accessed
via an Interlocked function must always be accessed via an Interlocked
function.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>If PREfast finds that a variable is accessed in a way that
seems likely to violate the intended semantics of the Interlocked() family of
functions, it will yield this warning.<span style='mso-spacerun:yes'> 
</span>In most cases it is a valid warning, but since there is not an explicit
interlocked read function, use of direct access to a variable may be
acceptable.<span style='mso-spacerun:yes'>  </span>Note however that there are
MP issues with per-processor caches that must be evaluated carefully in each
situation.<span style='mso-spacerun:yes'>  </span>It may be that an operation
such as </span><span style='font-size:10.0pt;font-family:"Courier New"'>InterlockedAdd</span><span
style='font-size:10.0pt;font-family:Arial'>(&amp;xxx, 0) may be needed to
obtain the correct semantics (that is, to be sure that the value being read
came from memory, not from per-processor cache).<span
style='mso-spacerun:yes'>  </span>The reader is referred to the explicit
function definitions for details.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8113: Accessing a local
variable &lt;name&gt; via an Interlocked function.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Except in the rarest of circumstances, local variables are
not shared across processors.<span style='mso-spacerun:yes'>  </span>If this is
reported, it is highly likely that the Interlocked function is not performing
the intended operation. Since passing the address of a local variable to a peer
thread (that might be on another processor) is usually a risky operation, if
this is being done, it should be reconsidered.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8114: Copying a whole IRP
leaves certain fields initialized that should be cleared or updated.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Copying an IRP, intact, must be done carefully, as certain
members should not be left unmodified when the operation is completed.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warnings 8115-8119: &lt;reserved&gt;<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warnings 8120-8123: Various reports
about IRQL.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>These four reports indicate that the function being called
is apparently being called at an IRQL level that is not acceptable for that
function.<span style='mso-spacerun:yes'>  </span>If PREfast definitely knows
the IRQL, then reports 8120 or 8121 will be reported.<span
style='mso-spacerun:yes'>  </span>If it has inferred the IRQL from prior calls
to other functions along the same path, 8122 and 8123 can be generated.<span
style='mso-spacerun:yes'>  </span>In this latter case, although the error is
reported at a later point in the function, the actual error may have occurred
earlier (when the IRQL was implied to be in a specific range by the earlier
function).<span style='mso-spacerun:yes'>  </span>If report 8101 is also
generated for this function, the initial IRQL for this function was set
appropriately for that function type. Note that PREfast attempts to track the
various functions that save and restore the IRQL, either in a driver-provided
variable or in some other state information.<span style='mso-spacerun:yes'> 
</span>Specifically, this implies that after a restore, the inferred state
could have been inferred much earlier in the function.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>These reports tend to be accurate, but need to be
investigated carefully because the proper fix may not be the obvious one, or
PREfast may have been mislead by some flow of control change it did not
see.<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8124: The function
&lt;name&gt; causes the IRQ Level to be set below the minimum acceptable for
the function.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This occurs in association with report 8101.<span
style='mso-spacerun:yes'>  </span>If the drivers module has inferred that a
function is one of the known types, and it discovers that the IRQ Level has
been set to a value below that acceptable for the function, this warning is
generated.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8125: This function must be
called from within a try/except block.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The various </span><span style='font-size:10.0pt;font-family:
"Courier New"'>ProbeFor</span><span style='font-size:10.0pt;font-family:Arial'>…
functions must be called inside a try/except block.<span
style='mso-spacerun:yes'>  </span>This can be mislead if the probe function is
called inside a nested function, but this is not a typical usage.<o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8126: The AccessMode
parameter to ObReferenceObject* should be IRP-&gt;RequestorMode.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This really is testing that the argument is not a constant;
normally it should </span><span style='font-size:10.0pt;font-family:"Courier New"'>be
IRP-&gt;RequestorMode</span><span style='font-size:10.0pt;font-family:Arial'>
to be sure that the mode is passed on successfully.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8127: The function being
used as a &lt;Callback Name&gt; routine does not exactly match the type
expected.<span style='mso-spacerun:yes'>  </span>Have ‘&lt;type name&gt;',
expecting '&lt;type name&gt;'<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>A few of the APIs that take functions as parameters for
callbacks or other similar use do not check the function type strictly, and
even when they do, there are potential type relaxations that might be
unexpected.<span style='mso-spacerun:yes'>  </span>This rule also helps find
situations where rule 8101 misses a function that is being used in this way.<span
style='mso-spacerun:yes'>   </span>Changing the function type to strictly match
may enable finding other problems in the driver.<span
style='mso-spacerun:yes'>  </span>This report is always “correct”, but it may
not always be interesting, depending on the context.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8128: An access to &lt;field
name&gt; has been made directly. It should be made by &lt;API name&gt;.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Some fields in a structure should have values set by an API
function rather than directly by the driver because there are other actions
that should be taken at the same time, and which might change over time.<span
style='mso-spacerun:yes'>   </span>The assignment should be replaced with the
recommended function.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8129: An assignment has been
made to &lt;operand&gt; which should only be modified using bit sets and
clears.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Specifically, this applies to the Flags member of the Device
Object.<span style='mso-spacerun:yes'>  </span>It should never get a direct
assignment of a value, but rather should have specific bits modified.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8130: &lt;reserved&gt;.<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8131:</span> </b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
Arial'>The DriverEntry routine should save a copy of the argument
&lt;argname&gt;, not the pointer, since the I/O Manager frees the buffer after
DriverEntry returns.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>If it appears that the Driver Entry function is saving the
address of the Registry Path argument, this diagnostic is generated.<span
style='mso-spacerun:yes'>  </span>It can be fooled by complex operations, but
straightforward code should be accurately diagnosed.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8132: Taking the size of
pointer &lt;operand&gt;.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>A frequent coding error is to take the size of a pointer
rather than the size of the object pointed to.<span style='mso-spacerun:yes'> 
</span>This flaw can cause some surprising errors.<span
style='mso-spacerun:yes'>  </span>If, as occasionally happens, the size of a
pointer is intended, the size of the pointer type (as opposed to a pointer
variable) can be used, or </span><span style='font-size:10.0pt;font-family:
"Courier New"'>sizeof(void *)</span><span style='font-size:10.0pt;font-family:
Arial'> will work.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8133: IoInitializeTimer is
best called from AddDevice.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is advisory.<span style='mso-spacerun:yes'> 
</span>Since </span><span style='font-size:10.0pt;font-family:"Courier New"'>IoInitializeTimer</span><span
style='font-size:10.0pt;font-family:Arial'> (as distinct from </span><span
style='font-size:10.0pt;font-family:"Courier New"'>KeInitializeTimer</span><span
style='font-size:10.0pt;font-family:Arial'>) can only be called once per device
object, the AddDevice routine is a particularly safe place to put this.<span
style='mso-spacerun:yes'>  </span>If it is called in a function called by </span><span
style='font-size:10.0pt;font-family:"Courier New"'>AddDevice</span><span
style='font-size:10.0pt;font-family:Arial'> (only) then this report should be
ignored.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8134: The type of a pool tag
should be integral, not a string or string pointer.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Pool tags have been a source of much confusion.<span
style='mso-spacerun:yes'>  </span>The proper way to code a pool tag is as a
4-byte character (not string) literal (that is, </span><span style='font-size:
10.0pt;font-family:"Courier New"'>'gaT_'</span><span style='font-size:10.0pt;
font-family:Arial'> is the proper way to create a pool tag called </span><span
style='font-size:10.0pt;font-family:"Courier New"'>_Tag</span><span
style='font-size:10.0pt;font-family:Arial'>.)<span style='mso-spacerun:yes'> 
</span>Character constants are integral values.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8135: If the first argument
to KeWaitForSingleObject is a local variable, the Mode parameter must be
KernelMode.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This is highly accurate and straightforward.<span
style='mso-spacerun:yes'>  </span>Failure to follow this rule can cause system
crashes.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8136: The last (PIRP)
argument to PoRequestPowerIrp should always be NULL.<span
style='mso-spacerun:yes'>  </span>It is '&lt;operand&gt;'.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The IRP argument that </span><span style='font-size:10.0pt;
font-family:"Courier New"'>PoRequestPowerIrp</span><span style='font-size:10.0pt;
font-family:Arial'> returns can be completed before </span><span
style='font-size:10.0pt;font-family:"Courier New"'>PoRequestPowerIrp</span><span
style='font-size:10.0pt;font-family:Arial'> returns to the caller.<span
style='mso-spacerun:yes'>  </span>Should this happen, the returned pointer will
be pointing to memory that no longer contains a valid IRP, and should not be
accessed. This is particularly likely if there are many interrupts, or on MP
machines<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8137: The variable argument
'&lt;operand&gt;' should instead be a constan</span></b><span style='font-size:
10.0pt;font-family:Arial'>t.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Certain functions should always be called with a constant
argument.<span style='mso-spacerun:yes'>  </span>This can be mislead by wrapper
functions that simply pass their argument to the callee.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8138: The constant argument
'&lt;operand&gt;' should instead be variable.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Certain functions should never be called with a constant
argument.<span style='mso-spacerun:yes'>  </span>In particular, the I/O address
of a hardware device is rarely a constant.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8139: The argument
'&lt;operand&gt;' should exactly match the type ('&lt;typename&gt;').<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>Many functions take enum parameters, and only the specific
enumerated values should be passed.<span style='mso-spacerun:yes'>  </span>The C
compiler does not enforce this for enum types, so PREfast does this.<span
style='mso-spacerun:yes'>  </span>Normally, the enum type is the type of the
formal parameter, but in a few instances the type in the formal parameter is
not the enum type, but rather some form of integer, which the compiler silently
converts.<span style='mso-spacerun:yes'>  </span>This also may be
detected.<span style='mso-spacerun:yes'>  </span>Types other than enums may
also be detected this way.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8140: &lt;reserved&gt;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8141: The argument
&lt;operand&gt; causes the IRQ Level to be set below the current IRQL, and this
function cannot be used for that purpose.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:"Courier New"'>KeRaiseIrql</span><span style='font-size:10.0pt;
font-family:Arial'>, in particular, should not ever be used to lower the
current IRQL.<span style='mso-spacerun:yes'>  </span>This is commonly, and
incorrectly, done to allow a call to some function that requires a low
IRQL.<span style='mso-spacerun:yes'>  </span>However, this introduces the risk
of races and other timing errors.<span style='mso-spacerun:yes'>  </span>The
code should be rewritten so that the IRQL is restored properly with </span><span
style='font-size:10.0pt;font-family:"Courier New"'>KeLowerIrql</span><span
style='font-size:10.0pt;font-family:Arial'> or a function that restores a saved
IRQL.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8142: The argument
&lt;operand&gt; is a constant and is being passed in a context where a resource
release or other restoration of a prior state is being made.<span
style='mso-spacerun:yes'>  </span>An object containing a resource should be
passed.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This probably indicates a coding error, but may indicate
misuse of a function.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8143: A dispatch routine
that calls IoMarkIrpPending must also return STATUS_PENDING.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This warning is only generated when PREfast determines that
the current function is a dispatch function (and that determination can be
incorrect).<span style='mso-spacerun:yes'>  </span>Each dispatch function
(including all the called functions) must be sure that if </span><span
style='font-size:10.0pt;font-family:"Courier New"'>IoMarkIrpPending</span><span
style='font-size:10.0pt;font-family:Arial'> is called on an IRP that the status
returned is </span><span style='font-size:10.0pt;font-family:"Courier New"'>STATUS_PENDING</span><span
style='font-size:10.0pt;font-family:Arial'>, and vice-versa.<span
style='mso-spacerun:yes'>  </span>Otherwise the driver may hang or a system
crash may occur.<span style='mso-spacerun:yes'>  </span>Since upper level
dispatch functions should not redundantly call </span><span style='font-size:
10.0pt;font-family:"Courier New"'>IoMarkIrpPending</span><span
style='font-size:10.0pt;font-family:Arial'>, but may pass </span><span
style='font-size:10.0pt;font-family:"Courier New"'>STATUS_PENDING</span><span
style='font-size:10.0pt;font-family:Arial'> through to the caller, PREfast does
not detect returning </span><span style='font-size:10.0pt;font-family:"Courier New"'>STATUS_PENDING</span><span
style='font-size:10.0pt;font-family:Arial'> without calling </span><span
style='font-size:10.0pt;font-family:"Courier New"'>IoMarkIrpPending</span><span
style='font-size:10.0pt;font-family:Arial'>.<span style='mso-spacerun:yes'>  
</span>There are occasional situations where doing only one of the operations
will work, but it recommended that if one is done, the other is always done
somewhere in the dispatch routine.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8144: Within a cancel
routine, at the point of exit, the IRQL found Irp-&gt;CancelIrql should be the
current IRQL.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The current function has been tentatively identified as a
cancel routine, and PREfast was unable to find a path through that function
that restores the correct IRQL value.<span style='mso-spacerun:yes'>  
</span>If the function is not a cancel routine, this should be ignored.<span
style='mso-spacerun:yes'>  </span>Some cancel routines are sufficiently complex
that PREfast is unable to determine that the value is correctly restored, but
if it is not, the code should be corrected.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8145: The opaque MDL
structure should not be modified by a driver.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>It is generally not good practice to modify the MDL
structure.<span style='mso-spacerun:yes'>  </span>This should be avoided.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8146: Kernel Mode drivers
should use ntstrsafe.h, not strsafe.h.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The header ntstrsafe.h contains versions of the functions
found in strsafe.h that are suitable for use in kernel mode code.<span
style='mso-spacerun:yes'>  </span>Non kernel-mode code can use strsafe.h.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8147: The use of a default pool tag ('kdD' or 'mdW' or 'None') for calls to this function defeats the purpose of pool tagging.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The program set a default pool tag or used an obsolete function that set a default pool tag. Because memory pool allocations are tracked by pool tag, only allocations with a unique pool tag can be identified in the statistics that the system gathers for pool allocations. When allocating pool memory, use <B>ExAllocatePoolWithTag</B> and <B>ExAllocatePoolWithQuotaTag</B> (not <B>ExAllocatePool</B> or <B>ExAllocatePoolWithQuota</B>) and always specify a unique tag value.<span
style='mso-spacerun:yes'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warnings 8148-8191: &lt;reserved&gt;<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8192: No resource of the
class ‘&lt;class&gt;’ can be held when this function is called.<span
style='mso-spacerun:yes'>  </span>‘&lt;variable&gt;’ is currently held.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>This usually indicates that PREfast has discovered that a
spin lock is held while calling a function that should not be called with spin
locks held (specifically </span><span style='font-size:10.0pt;font-family:"Courier New"'>IoCompleteRequest</span><span
style='font-size:10.0pt;font-family:Arial'>).<span style='mso-spacerun:yes'>  
</span>Doing this risks deadlocks.<span style='mso-spacerun:yes'>  </span>In
some situations holding a lock may not actually cause a deadlock, but a small
change elsewhere in the system could introduce an unexpected deadlock.<span
style='mso-spacerun:yes'>  </span>It is recommended that doing this be avoided.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>Warning 8193: <Variable> holds a value that must be examined.<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
font-family:Arial'>The program failed to examine the value of a variable that the called function set. For example, after calling <B>IoGetDmaAdapter</B>, the calling program must verify that the value of the <I>NumberOfMapRegisters</I> variable that the function returns is at least the number requested. <span style='mso-spacerun:yes'>  </span>This should be avoided.<o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>


<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:Arial'>© 2004 Microsoft Corporation.<span
style='mso-spacerun:yes'>  </span>All rights reserved.<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-right:21.1pt'><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

</div>

<div style='mso-element:footnote-list'><![if !supportFootnotes]><br clear=all>

<hr align=left size=1 width="33%">

<![endif]>

<div style='mso-element:footnote' id=ftn1>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn1' href="#_ftnref1"
name="_ftn1" title=""><span class=MsoFootnoteReference><span style='mso-special-character:
footnote'><![if !supportFootnotes]><span class=MsoFootnoteReference><span
style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"Times New Roman";mso-ansi-language:EN-US;mso-fareast-language:EN-US;
mso-bidi-language:AR-SA'>[1]</span></span><![endif]></span></span></a> <span
style='font-family:Arial'>Your assertion will only suppress the Warning in a
checked build, and only if it is coded so that it directly calls one of the
functions that PREfast knows exits. The normal ASSERT macro used in drivers
calls RtlAssert, which is one such function (as are a number of other functions
commonly used in ASSERTs.)</span></p>

</div>

</div>

</body>

</html>
