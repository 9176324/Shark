<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="vhidmini_files/filelist.xml">
<title>VHIDMINI</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:LastAuthor>john osborne</o:LastAuthor>
  <o:Revision>62</o:Revision>
  <o:TotalTime>690</o:TotalTime>
  <o:Created>2002-07-08T21:54:00Z</o:Created>
  <o:LastSaved>2004-10-07T22:44:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1979</o:Words>
  <o:Characters>11282</o:Characters>
  <o:Company>Microsoft Corporation</o:Company>
  <o:Lines>94</o:Lines>
  <o:Paragraphs>26</o:Paragraphs>
  <o:CharactersWithSpaces>13235</o:CharactersWithSpaces>
  <o:Version>11.6360</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>75</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h4
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:4;
	font-size:12.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";
	color:black;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:473184148;
	mso-list-template-ids:-1351318452;}
@list l0:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1
	{mso-list-id:505704747;
	mso-list-type:hybrid;
	mso-list-template-ids:2087346806 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2
	{mso-list-id:594637288;
	mso-list-type:hybrid;
	mso-list-template-ids:677543848 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l2:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3
	{mso-list-id:981159362;
	mso-list-type:hybrid;
	mso-list-template-ids:-2033015144 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l3:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4
	{mso-list-id:1578325719;
	mso-list-type:hybrid;
	mso-list-template-ids:1516041636 67698693 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
@list l4:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5
	{mso-list-id:1939633541;
	mso-list-type:hybrid;
	mso-list-template-ids:-1997396706 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l5:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<h2><span style='font-family:Verdana'>VHIDMINI<o:p></o:p></span></h2>

<h3><span style='font-family:Verdana'>SUMMARY<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Vhidmini.sys is a sample
HID minidriver that demonstrates the following:<o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l4 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>§<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>How
to communicate with an HID <span class=SpellE>minidriver</span> from an HID
client using a custom-feature item in order to control certain features of the
HID minidriver. This is needed since other conventional modes for communicating
with a driver, like custom IOCTL or WMI, do not work with the HID minidriver. </span><span
style='font-family:Verdana'><o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l4 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>§<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>How
to test a HID report descriptor without using a physical device. </span><span
style='font-family:Verdana'><o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l4 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>§<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>The
structure of a HID minidriver and handling of internal IOCTLs sent by the <span
class=SpellE>HIDclass</span> driver. </span><span style='font-family:Verdana'><o:p></o:p></span></p>

<h4><span style='font-family:Verdana'>Introduction to the HID <span
class=SpellE>Minidriver</span><o:p></o:p></span></h4>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>A
driver registers itself to be a HID minidriver by calling the API <span
class=SpellE><span class=GramE>HIDRegisterMinidriver</span></span><span
class=GramE>(</span>) in its DriverEntry() routine and passing the HID_MINIDRIVER_REGISTRATION
structure as an argument (after filling this structure with necessary
information). As a result of calling this API, the Hidclass driver (<span
class=SpellE>hidclass.sys</span>) takes charge and all subsequent system calls
to the minidriver first get handled by the Hidclass driver. <o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
hidclass driver creates a device object for the HID minidriver, attaches to the
PDO and calls <span class=GramE>AddDevice(</span>) routine of the HID
minidriver passing the functional device object it created for the HID
minidriver.<span style='mso-spacerun:yes'>  </span>After the <span class=GramE>AddDevice(</span>)
returns successfully, the minidriver starts receiving PnP IRPs. In the
IRP_MN_START_DEVICE, the minidriver takes appropriate actions and sets the
state of the device. After IRP_MN_START_DEVICE completes, the HID minidriver
starts receiving internal IOCTL requests from the Hidclass driver. The internal
IOCTLs that a HID minidriver must handle are:<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>IOCTL_HID_DEVICE_DESCRIPTOR<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>IOCTL_HID_DEVICE_ATTRIBUTES<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>IOCTL_HID_REPORT_DESCRIPTOR<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
hidclass driver parses the report descriptor and creates a PDO corresponding to
each top-level collection declared in the report descriptor. The PnP manager
looks for appropriate function driver (HID client drivers) for these collection
<span class=SpellE>PDOs</span> and loads them if it finds a matching one.<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>If
the Hidclass driver finds an input item in any of the collections, it starts
sending internal IOCTL request IOCTL_HID_READ_REPORT<span
style='mso-spacerun:yes'>  </span>to read input report. The Hidclass driver
sends these requests in two ways: if the device is declared as a polled device
by setting the flag “<span class=SpellE>DevicesArePolled</span>” in the
HID_MINIDRIVER_REGISTRATION structure then the class driver starts polling
process and sends IOCTL_HID_READ_REPORT report at a regular interval of time,
otherwise it sends certain number of IRPs (generally two), also called
ping-pong IRPs, to read the input report and reuses those IRPs once they are
completed. USB HID devices do not need polling at regular interval since they
use interrupt transfer to send or receive data at regular interval.<span
style='mso-spacerun:yes'>  </span>A legacy device may however need to be polled
in which case the corresponding HID mini driver has to set the <span
class=SpellE>DevicesArePolled</span> flag in the HID_MINIDRIVER_REGISTRATION
structure.<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
vhidmini.sys sample minidriver has inline comments that explain the purpose of
internal IOCTLs sent by the Hidclass driver<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>Introduction to the vhidmini.sys HID
Minidriver Sample <o:p></o:p></span></h4>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>Vhidmini.sys
is a sample HID minidriver. The sample is installed as a root-enumerated driver
using <span class=SpellE>devcon</span> utility. During installation the INF
file <span class=SpellE>vhidmini.inf</span> adds a registry entry containing
the report descriptor in the device parameters path. The driver registers
itself as a HID minidriver in the <span class=GramE>DriverEntry(</span>). In
the IRP_MN_START_DEVICE, it reads the report descriptor from the registry and
stores it in its device extension. The minidriver then reports necessary
descriptors (HID descriptor, report descriptor, device attributes etc.) to the
Hidclass driver through internal IOCTL interface. With actual USB HID devices,
these descriptors are usually burned into the device’s firmware but with this
sample driver these are hard-coded in the driver itself to simulate a HID
device.<span style='mso-spacerun:yes'>  </span>The Hidclass driver then creates
one PDO corresponding to one top-level collection declared in the report
descriptor. The PnP manager finds a hardware ID match in <span class=SpellE>vhidmini.inf</span>
file (supplied with the sample package) and installs a null service as
specified in the INF file. <o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
Hidclass driver finds an input item in one of the collections and therefore
starts sending ping-pong IRPs (since the HID minidriver reported the device to
be non-Polled) to read input reports using IOCTL_HID_READ_REPORT. The <span
class=SpellE><span class=GramE>ReadReport</span></span><span class=GramE>(</span>)
routine in vhidmini.sys handles this request. It allocates a timer and a DPC
structure and queues the timer DPC each time it receives a read request. The
DPC callback routine gets called when the time interval set in the timer
elapses. The callback routine copies two bytes (one byte for the report ID and
the other a random character byte) to the IRP and completes the IRP. It also
frees the timer and the DPC structures. This continues as long as the
minidriver receives read requests. This simple technique of handling read IRPs
was chosen because the goal of this minidriver was to keep the code as simple
as possible and not to confuse developers with complex queuing and cancellation
issues in handling read IRPs. <o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
sample also implements code to handle IOCTL_HID_GET_FEATURE and
IOCTL_HID_SET_FEATURE requests. They are explained below.<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana'>Communicating with HID
minidriver using custom feature item:<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
conventional way of communicating with a driver from a user mode application is
to use IOCTL interface or WMI interface. These methods do not work in case of
HID minidriver because the system-supplied Hidclass driver handles these for
the HID minidriver and does not allow these requests to reach the minidriver.
As a work around, this sample demonstrates the use of custom feature items to
communicate with the HID minidriver. <o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>As
explained earlier, the HID minidriver creates a virtual HID device. This
virtual HID device corresponds to one collection reported in the report
descriptor. This collection has one feature item of 1 byte dedicated for
communicating with HID clients.<span style='mso-spacerun:yes'>  </span>HID
clients obtain a handle to this collection (or virtual hid device) and use <span
class=SpellE>HidD_GetFeature</span> API (documented in the DDK) to send custom
control information to this collection. The HID minidriver receives the custom
control information through the internal IOCTL IOCTL_HID_GET_REPORT and
switches to appropriate code based on the control code (one-byte control code
is defined in a common header file so both the application and the minidriver
are aware of it).<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana'>Testing report
descriptor without using physical device:<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
sample driver reads report descriptor from registry (the descriptor is written
to the registry through INF file during installation of HID minidriver). In
order to test your descriptor, you need to modify/add the report descriptor in
the registry. The report descriptor is a binary value named “<span
class=SpellE>MyReportDescriptor</span>” located under the following key in the
registry:<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\Root\HIDCLASS\&lt;instance#&gt;\Device
Parameters<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>After
modifying, disable and re-enable the virtual HID minidriver. This will cause
the minidriver to unload and reload, this time reading the new/modified report
descriptor from the registry. If the system finds a problem with the
descriptor, it will not install the virtual HID minidriver and you will see
yellow exclamation mark in the device manager. This method makes it easy to
test a report descriptor without using an actual physical device. <o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>One
thing to remember is that, if your report descriptor declares an input item
then you need to implement code for handling IOCTL_HID_READ_REPORT. This is
because when the Hidclass driver finds a collection with an input item, it will
start polling the HID minidriver. <o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>The
sample has been tested on the following platforms:<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;
font-weight:normal'><span style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Windows 98/Me<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;
font-weight:normal'><span style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Windows 2000 <o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;
font-weight:normal'><span style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Windows XP<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;
font-weight:normal'><span style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Windows Server 2003<o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>This
sample does not use any new OS features that need back-porting and does not use
any obsolete functions.<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>Contents of <span class=SpellE>vhidmini</span>
sample driver folder<o:p></o:p></span></h4>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample driver
package contains <i>sys</i> and <i>exe</i> directories. The following summary
describes the directories and key files. <o:p></o:p></span></p>

<p><span class=GramE><i><span style='font-size:10.0pt;font-family:Verdana'>sys</span></i></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>This
directory contains the source code of the virtual HID minidriver
(vhidmini.sys). <o:p></o:p></span></p>

<p><span class=GramE><i><span style='font-size:10.0pt;font-family:Verdana'>exe</span></i></span><i><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></i></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>This
directory contains the source code of a test application (testvHID.exe). <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>BUILDING THE SAMPLE<o:p></o:p></span></h3>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
style='font-size:10.0pt;font-family:Verdana'>The sample driver can be built
using the following build environments:<o:p></o:p></span></p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l3 level1 lfo3;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Windows 2000 build environment (checked or free) from
     Windows 2000 DDK or Windows XP DDK</span> <span style='font-size:10.0pt;
     font-family:Verdana'><o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l3 level1 lfo3;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Windows XP build environment (checked or free) from
     Windows XP DDK</span> <span style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l3 level1 lfo3;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Windows Server 2003 build environment (checked or free) from
     Windows XP DDK</span> <span style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></li>
</ul>

<p><span style='font-size:10.0pt;font-family:Verdana'>To build the sample
driver and test application, you must first set up the DDK environment on your
host machine. The “Installation and Release Notes” in the Windows 2000/XP DDK has
a complete description on how to do this. <o:p></o:p></span></p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo4;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>In the build environment command window, change the
     folder to go to the <span class=SpellE>vhidmini</span> folder.</span> <span
     style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo4;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Enter the command “build –<span class=SpellE>ceZ</span>”
     to build vhidmini.sys and testvHID.exe files. </span></li>
</ol>

<h3><span style='font-family:Verdana'>INSTALLING THE SAMPLE<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>This virtual HID minidriver
sample could be installed either as a root-enumerated driver or as a
bus-enumerated driver. <o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Installing as a
root-enumerated driver:<o:p></o:p></span></b></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To install as a
root-enumerated driver, you could use a command-line utility called devcon.exe
available with the DDK in the &lt;ddk folder&gt;\tools\<span class=SpellE>devcon</span>
folder, or from the following link:<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'><a
href="http://support.microsoft.com/default.aspx?scid=kb;en-us;Q311272">http://support.microsoft.com/default.aspx?scid=kb;en-us;Q311272</a><o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Follow these steps to
install this sample using <span class=SpellE>devcon</span> utility:<o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo5;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana'><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>Open
a command window and change the folder to go to the temporary folder where you
copied the .sys, .exe and .inf files. Make sure the SYS file is copied under appropriate subdirectory (i386, ia64, amd64). <o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo5;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana'><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>Type
the following command line. Make sure that devcon.exe is either present in the
current directory or is in the command path.<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
text-indent:.5in;line-height:200%'><span style='font-size:10.0pt;line-height:
200%;font-family:Verdana'>C:\&gt;devcon <span class=GramE>install</span> <span
class=SpellE>vhidmini.inf</span>
“{D49F883C-6486-400a-8C22-1A9EF48577E4}\HID_DEVICE”<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>This will install the
vhidmini.sys driver as root-enumerated driver. Check in the Device Manager to
see if the driver is installed correctly. You will see the following entries
under “Human Interface Devices” in the Device Manager.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>On Windows 2000, you will
see the following:<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'><span
style='mso-spacerun:yes'>             </span>&quot;Root Enumerated Virtual HID
Minidriver (sample)&quot; <o:p></o:p></span></p>

<p style='text-indent:.5in'><span style='font-size:10.0pt;font-family:Verdana'><span
style='mso-spacerun:yes'>   </span>&quot;Virtual HID Device (sample)&quot; <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>On Windows XP, you will see
the following:<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'><span
style='mso-spacerun:yes'>             </span>&quot;Root Enumerated Virtual HID
Minidriver (sample)&quot;<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'><span
style='mso-spacerun:yes'>             </span>“HID-Compliant device”<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The reason that you see
“HID-compliant device” under Windows XP is because of a difference in the way
the two operating systems handle unsigned drivers. Windows XP prefers a signed
INF file over an unsigned one even if the unsigned INF has a better hardware id
match. Windows 2000, on the other hand, selects the INF file with a better
hardware-ID match irrespective of the signature. In this case Windows XP finds
a hardware id match in the system-supplied <span class=SpellE>input.inf</span>
file and therefore prefers installing the driver using this INF file. If you
want the system to use your unsigned INF file then you will have to use update
driver feature. To do this, right click on “HID-Compliant device” in the device
manager and select “Update Driver…” menu option. Select “Install from a list or
specific location (Advanced)” option, <span class=GramE>then</span> select
“Don’t search. I will choose the driver to install” <span class=GramE>option,
then click on “Have Disk” and point to your INF file</span> location. When
update completes, you will see “Virtual HID Device (sample)” in the device
manager instead of “HID-Compliant device”.<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Installing as a
bus-enumerated driver:<o:p></o:p></span></b></p>

<h3><span style='font-size:10.0pt;font-family:Verdana;font-weight:normal'>You
could use Toaster bus enumerator (a bus enumerator sample supplied with Windows
DDK) to enumerate this sample. Follow these steps:<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Install toaster bus enumerator (see Toaster documentation
for any help with this).<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Run Notify.exe program (comes with Toaster sample)<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Select “<span class=SpellE>Plugin</span>” option from “Bus”
menu.<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>In the “Plug <span class=GramE>In</span> Device” dialog
box, for “Device ID” enter the following hardware ID for the hid minidriver:<o:p></o:p></span></h3>

<h3 style='margin-left:.25in;text-indent:.25in'><span style='font-size:10.0pt;
font-family:Verdana;font-weight:normal'><span
style='mso-spacerun:yes'> </span>{D49F883C-6486-400a-8C22-1A9EF48577E4}\HID_DEVICE1<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Enter appropriate serial number in “Serial Number” edit box
(e.g. enter 1 if this is the first device that toaster bus is enumerating) and
click OK. <o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>You will see “Found New Hardware Wizard” popping up for
“Toaster Enumerated Virtual HID Minidriver (sample)&quot;. <o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Select “Install from a list or specific location
(Advanced)” option.<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>Select “Don’t search. <span class=GramE>I will choose the
driver to install” option.</span><span style='mso-spacerun:yes'>  </span>Click
on “Have Disk” and point to <span class=SpellE>vhidmini.inf</span> INF file
location. <o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>This will install the Hid minidriver.<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level2 lfo4;
tab-stops:list .5in 1.0in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana;
font-weight:normal'><span style='mso-list:Ignore'>10.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana;
font-weight:normal'>You will see “Found New Hardware Wizard” popping up again,
this time for “HID-compliant device”. Repeat steps 7 and 8.<o:p></o:p></span></h3>

<h3><span style='font-family:Verdana'>RUNNING THE SAMPLE<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Once the drivers are
installed correctly, you can use the provided application to test sending
control requests to the HID minidriver.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To run the test <span
class=GramE>application (testvhid.exe) do</span> the following:<o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana'><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>Open
a command window and change the folder to go to the temporary folder where you
copied the .sys, .exe and .inf files.<o:p></o:p></span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo6;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Verdana;mso-fareast-font-family:Verdana;mso-bidi-font-family:Verdana'><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>Run
the following command line:<o:p></o:p></span></p>

<p style='margin-left:.5in'><span style='font-size:10.0pt;font-family:Verdana'>C:\&gt;testvhid<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>You will see device
attributes information printed in the command window. The test application sent
a control code HIDMINI_CONTROL_CODE_GET_ATTRIBUTES using <span class=SpellE>HidD_<span
class=GramE>GetFeature</span></span><span class=GramE>(</span>) to get the
device attributes information from the minidriver and printed it in the command
window. <o:p></o:p></span></p>

<p style='margin:0in;margin-bottom:.0001pt;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p style='margin:0in;margin-bottom:.0001pt;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p align=center style='margin:0in;margin-bottom:.0001pt;text-align:center;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:Verdana;mso-fareast-font-family:"Courier New";
mso-bidi-font-family:"Courier New"'><a href="#_Communicating_with_SCSI">Top of
page </a></span><span class=MsoHyperlink><span style='font-family:Verdana;
mso-fareast-font-family:"Courier New"'><o:p></o:p></span></span></p>

<pre><o:p>&nbsp;</o:p></pre>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=827
 style='width:620.5pt;mso-cellspacing:0in;mso-padding-alt:0in 0in 0in 0in'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td width=827 style='width:620.5pt;background:aqua;padding:.75pt .75pt .75pt .75pt;
  height:1.5pt'>
  <p class=MsoNormal>&nbsp;<span style='color:black'><o:p></o:p></span></p>
  </td>
 </tr>
</table>

<pre><span style='mso-bidi-font-family:"Courier New"'><o:p>&nbsp;</o:p></span></pre><pre><span
style='mso-bidi-font-family:"Courier New"'><o:p>&nbsp;</o:p></span></pre>

<p style='margin:0in;margin-bottom:.0001pt;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:7.5pt;font-family:"MS Sans Serif";mso-fareast-font-family:
"Courier New";mso-bidi-font-family:"Courier New"'>© 2004 Microsoft Corporation</span><span
style='font-size:10.0pt;font-family:Verdana;mso-fareast-font-family:"Courier New";
mso-bidi-font-family:"Courier New"'> <o:p></o:p></span></p>

<p style='tab-stops:105.0pt'><span style='font-size:10.0pt;font-family:Verdana'><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
