<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="tracedrv4_files/filelist.xml">
<title>Sample Name</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>jose sua</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>June Blender</o:LastAuthor>
  <o:Revision>5</o:Revision>
  <o:TotalTime>314</o:TotalTime>
  <o:Created>2005-03-02T23:20:00Z</o:Created>
  <o:LastSaved>2005-03-02T23:46:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>757</o:Words>
  <o:Characters>4321</o:Characters>
  <o:Company>Microsoft Corporation</o:Company>
  <o:Lines>36</o:Lines>
  <o:Paragraphs>10</o:Paragraphs>
  <o:CharactersWithSpaces>5068</o:CharactersWithSpaces>
  <o:Version>11.6408</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:1627421319 -2147483648 8 0 66047 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;
	font-weight:bold;}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.MsoCommentReference
	{mso-style-noshow:yes;
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-noshow:yes;
	mso-style-parent:"Comment Text";
	mso-style-next:"Comment Text";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:8.0pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:1790778369;
	mso-list-template-ids:266362772;}
@list l0:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="6146"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<h2><span style='font-family:Verdana'>Tracedrv <o:p></o:p></span></h2>

<h3><span style='font-family:Verdana'>SUMMARY<o:p></o:p></span></h3>

<p class=MsoNormal>Tracedrv is a sample driver instrumented for software
tracing. The driver does not control any hardware; it simply generates trace
messages. It is designed to show how to use WPP software tracing macros in a
driver. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Tracedrv initializes tracing (by using WPP_INIT_TRACING)
and, when it receives a DeviceIOControl call, it starts a thread that logs 100
trace messages. The WPP software tracing directives, calls, and macros in the
code are accompanied by comments that explain their purpose.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>While examining Tracedrv, read the &quot;WPP Software
Tracing&quot; section of the Windows Driver Development Kit (DDK) documentation
(in Driver Development Tools, Tools for Software Tracing, WPP Software
Tracing). This section includes a reference section that describes the
directives, macros, and calls required for WPP software tracing. It also
includes &quot;<span style='mso-bidi-font-weight:bold'>Sample WPP Software
Tracing Code,</span>&quot; a section that uses the Tracedrv sample to
demonstrate the use of the WPP software tracing elements.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3><span style='font-family:Verdana'>USING THE SAMPLE<o:p></o:p></span></h3>

<p class=MsoNormal>To test the Tracedrv event tracing provider, use the
following procedure. The tools used in this procedure are included in the DDK
and located in the \tools\tracing subdirectory. For more information about the
tracing tools, see the &quot;Tools for Software Tracing&quot; section of the
DDK documentation.</p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>Build the Tracedrv sample
     driver by using the <b style='mso-bidi-font-weight:normal'>-cZg</b>
     switch. For more information, see &quot;Building a Sample Driver&quot; in
     the DDK.<br style='mso-special-character:line-break'>
     <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
     <![endif]></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>Build the Tracectl executable
     file by using the -<b style='mso-bidi-font-weight:normal'>cZg</b> switch.
     Tracectl is located in the \src\general\tracedrv\tracectl subdirectory of
     the DDK. Tracectl sends IOCTLs to Tracedrv, which then generates trace
     messages when it receives the IOCTLs.<br style='mso-special-character:
     line-break'>
     <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
     <![endif]><o:p></o:p></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>Copy<i style='mso-bidi-font-style:
     normal'> </i>the <i style='mso-bidi-font-style:normal'>Tracectl.exe </i>file
     that was created in step 2 from the Tracectl directory
     (\src\general\tracedrv\tracectl\<i style='mso-bidi-font-style:normal'>platform</i>)
     to the Tracedrv directory (\src\general\tracedrv\tracedrv\<i
     style='mso-bidi-font-style:normal'>platform</i>).<br style='mso-special-character:
     line-break'>
     <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
     <![endif]></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>Use Tracepdb to create a
     trace message format (TMF) file and a trace message control (TMC) file
     from the <i style='mso-bidi-font-style:normal'>Tracedrv.pdb</i> file.
     Tracepdb is located in the \tools\tracing\<i style='mso-bidi-font-style:
     normal'>platform</i> subdirectory of the DDK. The PDB file that is used in
     this command is created by the Build utility in step 1. From the
     \tools\tracing\<i style='mso-bidi-font-style:normal'>platform</i> subdirectory,
     type the following command: </li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>tracepdb -f &lt;path&gt;\tracedrv.pdb<o:p></o:p></span></p>

<ol start=5 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>Create a control GUID file
     for Tracedrv by opening a text file, adding the following content, and saving
     the file as Tracedrv.ctl. </li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-tab-count:1'>      </span>CtlGuid
d58c126f-b309-11d1-969e-0000f875a5bc<o:p></o:p></span></p>

<ol start=6 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>Use Tracelog to start a trace
     session that is called &quot;TestTracedrv&quot;. Tracelog is located in
     the \tools\tracing\<i style='mso-bidi-font-style:normal'>platform</i>
     subdirectory of the DDK. The <i style='mso-bidi-font-style:normal'>Tracedrv.ctl</i>
     file that is used in this command was created in step 4. The following
     command starts a trace session and creates a trace log file, <i
     style='mso-bidi-font-style:normal'>tracedrv.etl</i>, in the local
     directory.</li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-tab-count:1'>      </span>tracelog
-start TestTracedrv -guid tracedrv.ctl -f tracedrv.etl -flag 1<o:p></o:p></span></p>

<p style='margin-left:.5in'><b>Note:</b> Without the <b>-flag</b> parameter,
Tracedrv will not generate any trace messages.</p>

<ol start=7 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>To generate trace messages,
     run <i style='mso-bidi-font-style:normal'>Tracectl.exe</i>. This
     executable file is built in step 2. Each time you type a character, other
     than <b>Q</b> or <b>q</b>, Tracectl sends an IOCTL to the driver that
     signals it to generate trace messages. To stop Tracectl, type <b>Q</b> or <b>q</b>.<br
     style='mso-special-character:line-break'>
     <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
     <![endif]></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>To stop the trace session,
     use the following Tracelog command.</li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-tab-count:1'>      </span>tracelog
-stop TestTracedrv<o:p></o:p></span></p>

<ol start=9 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'>To display the trace messages
     in the <i style='mso-bidi-font-style:normal'>Tracedrv.etl</i> file, use
     Tracefmt. Tracefmt is located in the \tools\tracing subdirectory of the DDK.
     The TMF file used in this command was created by Tracepdb in step 3. Type the
     following command: </li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-tab-count:1'>      </span>tracefmt tracedrv.etl
-p &lt;Path to TMF file&gt; -o Tracedrv.out<o:p></o:p></span></p>

<p>The resulting <i style='mso-bidi-font-style:normal'>Tracedrv.out</i> file is
a human-readable text file of the Tracedrv trace messages. To interpret the
trace messages, in the <i style='mso-bidi-font-style:normal'>Tracedrv.c</i>
file, search for the <b>DoTraceMessage</b> macros.</p>

<p class=MsoNormal style='margin-left:.5in'><o:p>&nbsp;</o:p></p>

<h3><span style='font-family:Verdana'>LIMITATIONS<o:p></o:p></span></h3>

<p class=MsoNormal>This sample driver should not be used in a production
environment. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Tracedrv is designed for Windows&nbsp;XP and later versions
of Windows. It does not demonstrate how to add WPP software tracing to a
Windows&nbsp;2000 driver. (For information about adding WPP software tracing to
a Windows&nbsp;2000 driver, see the Tracing FAQ topic in the Windows DDK
documentation.)</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Also, because it is not a Plug and Play driver, Tracedrv
does not demonstrate tracing in a Plug and Play environment. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Tracedrv demonstrates the basic elements required for
software tracing. It does not demonstrate more advanced tracing techniques,
such as writing customized tracing calls (variations of <b style='mso-bidi-font-weight:
normal'>DoTraceMessage</b>), or the use of WMI calls for software tracing. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3><span style='font-family:Verdana'>FILE LIST<o:p></o:p></span></h3>

<p class=MsoNormal>drvioctl.h</p>

<p class=MsoNormal>makefile</p>

<p class=MsoNormal>sources</p>

<p class=MsoNormal>tracedrv.c</p>

<p class=MsoNormal>tracedrv.ctl</p>

<p class=MsoNormal>tracedrv.rc</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3><span style='font-family:Verdana'>LOCATION<o:p></o:p></span></h3>

<p class=MsoNormal>The files that comprise Tracedrv are included in the Windows
DDK in the \src\general\tracedrv directory.</p>

<h3><span style='font-family:Verdana'><o:p>&nbsp;</o:p></span></h3>

<h3><span style='font-family:Verdana'>FEEDBACK<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>We welcome your comments,
problem reports, and wish-list requests. Please submit them by visiting the <a
href="http://go.microsoft.com/fwlink/?linkid=8704&amp;clcid=0x409">Windows DDK
Web site</a>.<a href="http://www.microsoft.com/ddk"></a> </span><span
style='font-family:Courier'><o:p></o:p></span></p>

<p align=center style='text-align:center'><span style='font-size:10.0pt;
font-family:Verdana'><a
href="file:///D:\INF\Readmes%20-%20Post%20WinHEC%202000\ChkInf.htm#top">Top of
page</a> <o:p></o:p></span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in;mso-cellspacing:0in;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><span style='font-size:2.0pt;mso-bidi-font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p><span style='font-size:7.5pt;font-family:"MS Sans Serif"'>© Microsoft
Corporation 2005</span><span style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

</div>

</body>

</html>
